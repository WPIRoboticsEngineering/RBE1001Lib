

<!DOCTYPE html>

<html>
<head>
  <style>
  html,body{
    margin:0px;
  height:100%;
  }
  #static{
    width: 100%;
    height: 100%;
    background-color: #ccc;
  }

  .slidecontainer {
  width: 100%; /* Width of the outside container */
}

/* The slider itself */
.slider {
  -webkit-appearance: none;  /* Override default CSS styles */
  appearance: none;
  width: 100%; /* Full-width */
  height: 100px; /* Specified height */
  background: #d3d3d3; /* Grey background */
  outline: none; /* Remove outline */
  opacity: 0.7; /* Set transparency (for mouse-over effects on hover) */
  -webkit-transition: .2s; /* 0.2 seconds transition on hover */
  transition: opacity .2s;
}

/* The slider handle (use -webkit- (Chrome, Opera, Safari, Edge) and -moz- (Firefox) to override default look) */
.slider::-webkit-slider-thumb {
  -webkit-appearance: none; /* Override default look */
  appearance: none;
  width: 100px; /* Set a specific slider handle width */
  height: 100px; /* Slider handle height */
  background: #ff2222; /* Green background */
  cursor: pointer; /* Cursor on hover */
}

.slider::-moz-range-thumb {
  width: 25px; /* Set a specific slider handle width */
  height: 25px; /* Slider handle height */
  background: #4CAF50; /* Green background */
  cursor: pointer; /* Cursor on hover */
}
  </style>
  <script src="nipplejs.min.js"></script>
</head>
<body>
  <div class="slidecontainer">
  <input type="range" min="1" max="100" value="50" class="slider" id="myRange" oninput="sendSlider(0,this.value)">
</div>
  <div id="joystick"></div>


  <script>
      var manager = nipplejs.create({
          zone: document.getElementById('joystick'),
          mode: 'static',
          position: {left: '50%', top: '50%'},
          color: 'red'
      });

      let socket = new WebSocket("ws://192.168.86.30/test");
      socket.binaryType = 'arraybuffer';
      socket.onopen = function(e) {
        console.log("[open] Connection established");
        console.log("Sending to server");
      };
      socket.onmessage = function(event) {
        console.log(`[message] Data received from server: ${event.data}`);
      };

      socket.onclose = function(event) {
        if (event.wasClean) {
          console.log(`[close] Connection closed cleanly, code=${event.code} reason=${event.reason}`);
        } else {
          // e.g. server process killed or network down
          // event.code is usually 1006 in this case
          console.log('[close] Connection died');
        }
      };

      socket.onerror = function(error) {
        console.log(`[error] ${error.message}`);
      };

      manager.get(0).on('move start end',function(evt, data) {

        var nDist = 0.0;
        if(data.distance){
          nDist = data.distance/50.0
        }
        var Angle=0.0;
        if (data.angle){
                  Angle = data.angle.radian;
        }
        // build the packet
        var ab = new ArrayBuffer(20);
        var abFloat = new Float32Array(ab);
        var abInt = new Uint32Array(ab);
        abInt[0]=32; // js packet
        abFloat[1] = 1
        abFloat[2] = 1
        abFloat[3] = Angle;
        abFloat[4] = nDist;
        socket.send(ab);
      });

function sendSlider(num,value){
  // build the packet
  var ab = new ArrayBuffer(12);
  var abFloat = new Float32Array(ab);
  var abInt = new Uint32Array(ab);
  abInt[0]=48; // js packet
  abFloat[1] = num;
  abFloat[2] = value/100.0;
  socket.send(ab);
}
  </script>
</body>
</html>
